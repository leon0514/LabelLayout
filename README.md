# LabelLayoutSolver

ä¸€ä¸ªé«˜æ€§èƒ½ã€å¯é…ç½®çš„ 2D æ ‡ç­¾å¸ƒå±€æ±‚è§£å™¨ï¼Œé‡‡ç”¨ C++ ç¼–å†™å¹¶æä¾› Python ç»‘å®šã€‚å®ƒæ—¨åœ¨è§£å†³å¤æ‚çš„æ ‡æ³¨é‡å é—®é¢˜ï¼Œæ”¯æŒåŠ¨æ€å­—ä½“ç¼©æ”¾ã€ç©ºé—´ç´¢å¼•åŠ é€Ÿå’Œå¯å‘å¼è¿­ä»£ä¼˜åŒ–ã€‚

## ğŸŒ“ å¸ƒå±€æ•ˆæœå±•ç¤ºåŠè¿­ä»£è¿‡ç¨‹
![alt text](workspace/demo.gif)

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

*   **ç©ºé—´ç´¢å¼•åŠ é€Ÿ**ï¼šå†…ç½® `FlatUniformGrid`ï¼ˆå‡åŒ€ç½‘æ ¼ï¼‰ï¼Œåœ¨å¤„ç†æ•°ç™¾ä¸ªæ ‡ç­¾æ—¶ä¾ç„¶ä¿æŒé«˜æ€§èƒ½ã€‚
*   **å¤šç­–ç•¥å€™é€‰ç”Ÿæˆ**ï¼šæ”¯æŒåœ¨ç›®æ ‡ç‰©ä½“å‘¨è¾¹çš„å¤šä¸ªä½ç½®ï¼ˆå¦‚ Top-Outer, Side ç­‰ï¼‰å°è¯•å¸ƒå±€ã€‚
*   **åŠ¨æ€å­—ä½“ç¼©æ”¾**ï¼šå½“ç©ºé—´æ‹¥æŒ¤æ—¶ï¼Œç®—æ³•ä¼šè‡ªåŠ¨å°è¯•å‡å°å­—å·ä»¥å¯»æ‰¾éé‡å è§£ã€‚
*   **è½¯çº¦æŸä»£ä»·ç³»ç»Ÿ**ï¼šåŸºäºä»£ä»·å‡½æ•°ï¼ˆCost Functionï¼‰å¹³è¡¡æ ‡ç­¾ä½ç½®åå¥½ã€ç›®æ ‡é®æŒ¡ã€æ ‡ç­¾äº’æ–¥ç­‰å†²çªã€‚
*   **éšæœºåŒ–è¿­ä»£ä¼˜åŒ–**ï¼šé€šè¿‡éšæœºæ‰“ä¹±é¡ºåºçš„å±€éƒ¨æœç´¢ï¼ˆLocal Searchï¼‰æœºåˆ¶ï¼Œæœ‰æ•ˆé¿å…å±€éƒ¨æœ€ä¼˜ã€‚
*   **åŠ¨æ€è¾¹ç¼˜é‡‡æ ·**ï¼šåŸºäºç‰©ä½“è¾¹é•¿è‡ªåŠ¨è®¡ç®—æ»‘åŠ¨æ­¥é•¿ï¼ˆDynamic Stepsï¼‰ï¼Œç¡®ä¿æ ‡ç­¾èƒ½ç²¾å‡†é’»å…¥ç»†å°ç¼éš™ã€‚

## ğŸ›  ç¼–è¯‘ä¸å®‰è£…

### ç¯å¢ƒä¾èµ–
*   C++11 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¼–è¯‘å™¨
*   CMake (>= 3.15)
*   Python 3.x
*   [pybind11](https://github.com/pybind/pybind11) (`pip install pybind11`)

### pip å®‰è£…
```bash
pip install -e .
```

## ğŸ Python ä½¿ç”¨ç¤ºä¾‹

```python
import sys
import os
import layout_solver

def my_measure_func(text, font_size):
    # è¿™é‡Œå¯ä»¥ä½¿ç”¨ PIL.ImageFont æˆ– OpenCV çš„ getTextSize
    # è¿”å›: layout_solver.TextSize(width, height, baseline)
    estimated_width = len(text) * (font_size // 2)
    return layout_solver.TextSize(estimated_width, font_size, 2)

# 2. é…ç½®æ±‚è§£å™¨å‚æ•°
config = layout_solver.LayoutConfig()
config.maxIterations = 25
config.costOverlapBase = 100000.0   # æ ‡ç­¾é‡å çš„é«˜é¢æƒ©ç½š
config.costScaleTier = 5000.0       # é¼“åŠ±åœ¨å¿…è¦æ—¶ç¼©å°å­—ä½“

# 3. åˆå§‹åŒ–æ±‚è§£å™¨ (ç”»å¸ƒå®½é«˜: 1920x1080)
solver = layout_solver.LabelLayoutSolver(1920, 1080, my_measure_func, config)

# 4. æ·»åŠ å¾…å¸ƒå±€çš„å¯¹è±¡
# å‚æ•°: left, top, right, bottom, text, base_font_size
solver.add(100, 100, 200, 200, "Target_01", 16)
solver.add(150, 150, 250, 250, "Target_02", 16)

# 5. æ‰§è¡Œå¸ƒå±€è®¡ç®—
solver.solve()

# 6. è·å–ç»“æœ
results = solver.get_results()
for i, res in enumerate(results):
    print(f"Label {i}: pos=({res.x}, {res.y}), size={res.width}x{res.height}, font_size={res.fontSize}")
```

## âš™ï¸ å‚æ•°è¯¦è§£ (`LayoutConfig`)

| å±æ€§ | é»˜è®¤å€¼ | æè¿° |
| :--- | :--- | :--- |
| `costPos1_Top` | 0 | ä¼˜å…ˆçº§ 1ï¼šç‰©ä½“æ­£ä¸Šæ–¹å¯¹é½ |
| `costPos2_Right` | 10 | ä¼˜å…ˆçº§ 2ï¼šç‰©ä½“å³ä¾§å¯¹é½ |
| `costPos3_Bottom` | 20 | æ ‡ç­¾ä¹‹é—´ç›¸äº’é‡å çš„ä»£ä»·æƒé‡ã€‚ |
| `costPos4_Left` | 30 | ä¼˜å…ˆçº§ 4ï¼šç‰©ä½“å·¦ä¾§å¯¹é½ |
| `costSlidingPenalty` | 100 | æ»‘åŠ¨åŸºå‡†æƒ©ç½šã€‚è®¾ä¸º 100 ç¡®ä¿ä¼˜å…ˆå°è¯•å›ºå®šé”šç‚¹ï¼Œæ— è§£æ‰æ»‘åŠ¨ |
| `maxIterations`| 30 | è¿­ä»£è½®æ•°ã€‚é”šç‚¹å¢å¤šåï¼Œå»ºè®®è®¾ä¸º 30-50 ä»¥è·å¾—æ›´ç¨³å¥çš„ç»“æœã€‚ |
| `costScaleTier` | 10000 | ç¼©æ”¾æƒ©ç½šã€‚ä¿æŒæå¤§å€¼å¯ä¼˜å…ˆä¿è¯å­—å·ï¼Œå®åœ¨æ”¾ä¸ä¸‹æ‰ç¼©å°ã€‚ |
| `costOccludeObj` | 100000 | é®æŒ¡ç‰©ä½“çš„æƒ©ç½šï¼Œä¿æŒæå¤§å€¼ï¼Œä¸€æ—¦å‘ç”Ÿç¢°æ’ï¼Œæˆæœ¬ä¼šè¿…é€Ÿè¶…è¿‡æ»‘åŠ¨æƒ©ç½š|
| `costOverlapBase` | 100000 | æ ‡ç­¾é—´é‡å çš„æƒ©ç½šï¼Œä¿æŒæå¤§å€¼ï¼Œä¸€æ—¦å‘ç”Ÿç¢°æ’ï¼Œæˆæœ¬ä¼šè¿…é€Ÿè¶…è¿‡æ»‘åŠ¨æƒ©ç½š |
| `paddingX / Y` | 2 | æ ‡ç­¾æ–‡æœ¬å‘¨å›´é¢„ç•™çš„åƒç´ è¾¹è·ã€‚ |

## ğŸ“ ç®—æ³•åŸç†

1.  **å€™é€‰æ± ç”Ÿæˆ**ï¼šä¸ºæ¯ä¸ª Item ç”Ÿæˆä¸åŒæ–¹ä½ï¼ˆTop/Bottom/Left/Right/Outerï¼‰ä»¥åŠä¸åŒç¼©æ”¾çº§åˆ«ï¼ˆ1.0x, 0.9x, 0.8x, 0.75xï¼‰çš„å€™é€‰æ¡†ã€‚
2.  **é™æ€åˆå§‹åŒ–**ï¼šé¦–å…ˆè®¡ç®—å€™é€‰æ¡†ä¸æ‰€æœ‰å·²çŸ¥â€œç‰©ä½“æ¡†â€çš„é®æŒ¡å…³ç³»ï¼Œé€šè¿‡è´ªå¿ƒç­–ç•¥é€‰æ‹©ä¸€ä¸ªé™æ€å†²çªæœ€å°‘çš„ä½ç½®ã€‚
3.  **è¿­ä»£ä¼˜åŒ–**ï¼š
    *   åœ¨æ¯ä¸€è½®è¿­ä»£ä¸­ï¼Œéšæœºæ‰“ä¹±æ ‡ç­¾çš„å¤„ç†é¡ºåºã€‚
    *   é’ˆå¯¹æ¯ä¸ªæ ‡ç­¾ï¼Œé€šè¿‡ç©ºé—´ç´¢å¼•æŸ¥è¯¢ä¸å…¶å‘ç”Ÿé‡å çš„å…¶ä»–æ ‡ç­¾ã€‚
    *   è®¡ç®—å½“å‰â€œåŠ¨æ€ä»£ä»·â€ï¼Œå¹¶å°è¯•åœ¨å€™é€‰æ± ä¸­å¯»æ‰¾èƒ½é™ä½å…¨å±€æ€»ä»£ä»·ï¼ˆå‡ ä½•+é™æ€+åŠ¨æ€ï¼‰çš„æ›´å¥½ä½ç½®ã€‚
    *   å½“ä¸å†æœ‰ä½ç½®å˜åŠ¨æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°æ—¶åœæ­¢ã€‚

## ğŸ“„ è®¸å¯è¯
[MIT License](LICENSE)